<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sistema de PrevisÃ£o de Meta{% endblock %}</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-celadon">
    <!-- Navbar -->
    <nav class="bg-fire-engine-red text-white shadow-lg">
        <div class="container mx-auto flex justify-between items-center p-4">
            <a href="{{ url_for('index') }}" class="text-2xl font-bold">ðŸŽ¯ PrevisÃ£o de Meta</a>
            <div>
                {% if session.get('logged_in') %}
                    <a href="{{ url_for('banca_page') }}" class="mr-4 hover:underline">Dashboard</a>
                    <button id="logout-button" class="bg-glaucous hover:bg-periwinkle text-white py-2 px-4 rounded shadow">
                        Sair
                    </button>
                {% else %}
                    <a href="{{ url_for('login_page') }}" class="mr-4 hover:underline">Login</a>
                    <a href="{{ url_for('register_page') }}" class="bg-celadon hover:bg-periwinkle text-white py-2 px-4 rounded shadow">
                        Registrar
                    </a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- ConteÃºdo Principal -->
    <main class="container mx-auto p-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-glaucous text-white text-center py-4 mt-8">
        <p>&copy; 2025 PrevisÃ£o de Meta. Todos os direitos reservados.</p>
    </footer>

    {% block extra_scripts %}{% endblock %}
    <script>
        document.getElementById('logout-button')?.addEventListener('click', async function () {
            const result = await Swal.fire({
                title: 'Tem certeza?',
                text: "VocÃª serÃ¡ deslogado!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#c42021',
                cancelButtonColor: '#3b82f6',
                confirmButtonText: 'Sim, sair!',
                cancelButtonText: 'Cancelar'
            });
            if (result.isConfirmed) {
                try {
                    const response = await fetch('/logout', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({})
                    });
                    const data = await response.json();
                    if (response.ok) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Deslogado',
                            text: data.message,
                            confirmButtonText: 'Ok'
                        }).then(() => {
                            window.location.href = '/login';
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Erro',
                            text: data.message || 'Erro ao deslogar.',
                            confirmButtonText: 'Ok'
                        });
                    }
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro',
                        text: 'Erro ao deslogar. Tente novamente.',
                        confirmButtonText: 'Ok'
                    });
                    console.error('Erro ao deslogar:', error);
                }
            }
        });
    </script>
</body>
</html>
